Description: some tweaks to linux.pri
 use system libs, link libpci, run unbundling script
Author: Kevin Kofler
Origin: Fedora, http://pkgs.fedoraproject.org/cgit/rpms/qt5-qtwebengine.git/commit/qtwebengine-opensource-src-5.9.0-linux-pri.patch?id=c87d486b0024c40d9ecb66f76d518aadb53deb92
Forwarded: not-needed
Reviewed-by: Sandro Knau√ü <hefee@debian.org>
Last-Update: 2017-06-29
---
This patch header follows DEP-3: http://dep.debian.net/deps/dep3/
diff -ur qtwebengine-opensource-src-5.9.0/src/core/config/linux.pri qtwebengine-opensource-src-5.9.0-linux-pri/src/core/config/linux.pri
--- qtwebengine-opensource-src-5.9.0/src/core/config/linux.pri	2017-05-19 06:22:04.000000000 +0200
+++ qtwebengine-opensource-src-5.9.0-linux-pri/src/core/config/linux.pri	2017-06-08 00:20:53.688419747 +0200
@@ -148,3 +148,22 @@
     use?(system_ffmpeg):   gn_args += use_system_ffmpeg=true
     #use?(system_protobuf): gn_args += use_system_protobuf=true
 }
+
+# some more system packages, that are not checked for for some reason
+gn_args += use_system_re2=true
+
+# yasm is only used on x86, and passing use_system_yasm makes the build fail on
+# other architectures (e.g., ARM), so make it conditional on the architecture
+contains(QT_ARCH, "x86_64")|contains(QT_ARCH, "i386") {
+    gn_args += use_system_yasm=true
+}
+
+# link libpci instead of dlopening it, our Qt packaging depends on it anyway
+gn_args += linux_link_libpci=true
+
+# run the unbundling script Chromium provides
+CHROMIUM_SRC_DIR = "$$QTWEBENGINE_ROOT/$$getChromiumSrcDir()"
+R_G_F_PY = "$$CHROMIUM_SRC_DIR/build/linux/unbundle/replace_gn_files.py"
+R_G_F_PY_ARGS = "--system-libraries re2 yasm"
+log("Running python $$R_G_F_PY $$R_G_F_PY_ARGS$${EOL}")
+!system("python $$R_G_F_PY $$R_G_F_PY_ARGS"): error("-- unbundling failed")
