Description: Use system NSPR prtime
Author: Kevin Kofler
Origin: Fedora, http://pkgs.fedoraproject.org/cgit/rpms/qt5-qtwebengine.git/tree/qtwebengine-opensource-src-5.9.0-system-nspr-prtime.patch?id=f6784380ac380455d2c88b78543c5a4c2c5d0578
Forwarded: not-needed
Reviewed-by: Sandro Knau√ü <hefee@debian.org>
Last-Update: 2017-06-29
---
This patch header follows DEP-3: http://dep.debian.net/deps/dep3/
Index: qtwebengine-everywhere-src-5.10.0-alpha/src/3rdparty/chromium/base/BUILD.gn
===================================================================
--- qtwebengine-everywhere-src-5.10.0-alpha.orig/src/3rdparty/chromium/base/BUILD.gn
+++ qtwebengine-everywhere-src-5.10.0-alpha/src/3rdparty/chromium/base/BUILD.gn
@@ -58,6 +58,9 @@ config("base_flags") {
       "-Wno-char-subscripts",
     ]
   }
+  ldflags = [
+    "-lnspr4",
+  ]
 }
 
 config("base_implementation") {
@@ -884,8 +887,6 @@ component("base") {
     "third_party/dmg_fp/g_fmt.cc",
     "third_party/icu/icu_utf.cc",
     "third_party/icu/icu_utf.h",
-    "third_party/nspr/prtime.cc",
-    "third_party/nspr/prtime.h",
     "third_party/superfasthash/superfasthash.c",
     "third_party/valgrind/memcheck.h",
     "threading/non_thread_safe.h",
Index: qtwebengine-everywhere-src-5.10.0-alpha/src/3rdparty/chromium/base/time/pr_time_unittest.cc
===================================================================
--- qtwebengine-everywhere-src-5.10.0-alpha.orig/src/3rdparty/chromium/base/time/pr_time_unittest.cc
+++ qtwebengine-everywhere-src-5.10.0-alpha/src/3rdparty/chromium/base/time/pr_time_unittest.cc
@@ -7,7 +7,7 @@
 
 #include "base/compiler_specific.h"
 #include "base/macros.h"
-#include "base/third_party/nspr/prtime.h"
+#include <nspr/prtime.h>
 #include "base/time/time.h"
 #include "build/build_config.h"
 #include "testing/gtest/include/gtest/gtest.h"
Index: qtwebengine-everywhere-src-5.10.0-alpha/src/3rdparty/chromium/base/time/time.cc
===================================================================
--- qtwebengine-everywhere-src-5.10.0-alpha.orig/src/3rdparty/chromium/base/time/time.cc
+++ qtwebengine-everywhere-src-5.10.0-alpha/src/3rdparty/chromium/base/time/time.cc
@@ -14,7 +14,7 @@
 #include "base/logging.h"
 #include "base/macros.h"
 #include "base/strings/stringprintf.h"
-#include "base/third_party/nspr/prtime.h"
+#include <nspr/prtime.h>
 #include "build/build_config.h"
 
 namespace base {
Index: qtwebengine-everywhere-src-5.10.0-alpha/src/3rdparty/chromium/tools/gn/bootstrap/bootstrap.py
===================================================================
--- qtwebengine-everywhere-src-5.10.0-alpha.orig/src/3rdparty/chromium/tools/gn/bootstrap/bootstrap.py
+++ qtwebengine-everywhere-src-5.10.0-alpha/src/3rdparty/chromium/tools/gn/bootstrap/bootstrap.py
@@ -496,7 +496,6 @@ def write_gn_ninja(path, root_gen_dir, o
       'base/third_party/dmg_fp/dtoa_wrapper.cc',
       'base/third_party/dmg_fp/g_fmt.cc',
       'base/third_party/icu/icu_utf.cc',
-      'base/third_party/nspr/prtime.cc',
       'base/threading/non_thread_safe_impl.cc',
       'base/threading/post_task_and_reply_impl.cc',
       'base/threading/sequenced_task_runner_handle.cc',
@@ -605,7 +604,7 @@ def write_gn_ninja(path, root_gen_dir, o
     }
 
   if is_linux:
-    libs.extend(['-lrt'])
+    libs.extend(['-lrt', '-lnspr4'])
     ldflags.extend(['-pthread'])
 
     static_libraries['xdg_user_dirs'] = {
Index: qtwebengine-everywhere-src-5.10.0-alpha/src/3rdparty/chromium/tools/gn/BUILD.gn
===================================================================
--- qtwebengine-everywhere-src-5.10.0-alpha.orig/src/3rdparty/chromium/tools/gn/BUILD.gn
+++ qtwebengine-everywhere-src-5.10.0-alpha/src/3rdparty/chromium/tools/gn/BUILD.gn
@@ -274,6 +274,10 @@ executable("gn") {
     "//build/config/sanitizers:deps",
     "//build/win:default_exe_manifest",
   ]
+
+  libs = [
+    "nspr4",
+  ]
 }
 
 test("gn_unittests") {
